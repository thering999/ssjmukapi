openapi: 3.0.3
info:
  title: ssjmukapi
  version: "1.0.0"
  description: Public Open Data API for Provincial Health Office
servers:
  - url: http://localhost:8081/api/v1
security:
  - BearerAuth: []
paths:
  /ccm:
    post:
      summary: Send message via MOPH CCM (Admin)
      description: Generic proxy. Body will be forwarded as-is to configured CCM endpoint. Requires Bearer Token and CCM credentials configured in .env.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200': { description: OK }
        '401': { description: Unauthorized }
        '502': { description: Upstream error }
  /health:
    get:
      summary: Health check
      security: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      status:
                        type: string
  /facilities:
    get:
      summary: List facilities
      security: []
      parameters:
        - in: query
          name: province_code
          schema: { type: string, example: '34' }
        - in: query
          name: district_code
          schema: { type: string, example: '3401' }
        - in: query
          name: type
          schema: { type: string, enum: [HOSPITAL, CLINIC, PHC, OTHER] }
        - in: query
          name: q
          schema: { type: string }
        - in: query
          name: page
          schema: { type: integer, default: 1 }
        - in: query
          name: per_page
          schema: { type: integer, default: 50 }
      responses:
        '200':
          description: A paginated list of facilities
    post:
      summary: Create a new facility (Admin)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [code, name_th, type, province_code, district_code]
              properties:
                code: { type: string }
                name_th: { type: string }
                type: { type: string, enum: [HOSPITAL, CLINIC, PHC, OTHER] }
                province_code: { type: string }
                district_code: { type: string }
                lat: { type: number }
                lng: { type: number }
                phone: { type: string }
      responses:
        '201':
          description: Facility created
        '401':
          description: Unauthorized
  /facilities/{id}:
    get:
      summary: Get a facility by ID
      security: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: Facility detail
        '404':
          description: Not found
    put:
      summary: Update a facility (Admin)
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                code: { type: string }
                name_th: { type: string }
                type: { type: string, enum: [HOSPITAL, CLINIC, PHC, OTHER] }
                province_code: { type: string }
                district_code: { type: string }
                lat: { type: number }
                lng: { type: number }
                phone: { type: string }
      responses:
        '200':
          description: Facility updated
        '401':
          description: Unauthorized
        '404':
          description: Not found
    delete:
      summary: Delete a facility (Admin)
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: Facility deleted
        '401':
          description: Unauthorized
        '404':
          description: Not found
  /announcements:
    get:
      summary: List announcements
      security: []
      parameters:
        - in: query
          name: published
          schema: { type: integer, enum: [0, 1] }
        - in: query
          name: q
          schema: { type: string }
        - in: query
          name: page
          schema: { type: integer, default: 1 }
        - in: query
          name: per_page
          schema: { type: integer, default: 50 }
      responses:
        '200':
          description: A paginated list of announcements
    post:
      summary: Create a new announcement (Admin)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [title, body]
              properties:
                title: { type: string }
                body: { type: string }
                published: { type: integer, enum: [0, 1] }
                published_at: { type: string, format: date-time }
      responses:
        '201':
          description: Announcement created
        '401':
          description: Unauthorized
  /announcements/{id}:
    get:
      summary: Get an announcement by ID
      security: []
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: Announcement detail
        '404':
          description: Not found
    put:
      summary: Update an announcement (Admin)
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title: { type: string }
                body: { type: string }
                published: { type: integer, enum: [0, 1] }
                published_at: { type: string, format: date-time }
      responses:
        '200':
          description: Announcement updated
        '401':
          description: Unauthorized
        '404':
          description: Not found
    delete:
      summary: Delete an announcement (Admin)
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        '200':
          description: Announcement deleted
        '401':
          description: Unauthorized
        '404':
          description: Not found
  /contacts:
    get:
      summary: List contacts
      security: []
      parameters:
        - in: query
          name: q
          schema: { type: string }
        - in: query
          name: page
          schema: { type: integer, default: 1 }
        - in: query
          name: per_page
          schema: { type: integer, default: 50 }
      responses:
        '200':
          description: A paginated list of contacts
          content:
            application/json:
              schema:
                type: object
                properties:
                  meta:
                    type: object
                    properties:
                      page: { type: integer }
                      per_page: { type: integer }
                      total: { type: integer }
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id: { type: integer }
                        url: { type: string }
  /cases:
    get:
      summary: List disease cases (summary)
      security: []
      parameters:
        - in: query
          name: date_from
          schema: { type: string, format: date, example: '2025-01-01' }
        - in: query
          name: date_to
          schema: { type: string, format: date, example: '2025-01-31' }
        - in: query
          name: icd10
          schema: { type: string, example: 'J10' }
        - in: query
          name: province_code
          schema: { type: string, example: '34' }
        - in: query
          name: district_code
          schema: { type: string, example: '3401' }
        - in: query
          name: page
          schema: { type: integer, default: 1 }
        - in: query
          name: per_page
          schema: { type: integer, default: 50 }
      responses:
        '200':
          description: A paginated list of disease case records
  /vaccinations:
    get:
      summary: List vaccination records (summary)
      security: []
      parameters:
        - in: query
          name: date_from
          schema: { type: string, format: date, example: '2025-01-01' }
        - in: query
          name: date_to
          schema: { type: string, format: date, example: '2025-01-31' }
        - in: query
          name: vaccine_code
          schema: { type: string, example: 'COVID19' }
        - in: query
          name: province_code
          schema: { type: string, example: '34' }
        - in: query
          name: page
          schema: { type: integer, default: 1 }
        - in: query
          name: per_page
          schema: { type: integer, default: 50 }
      responses:
        '200':
          description: A paginated list of vaccination records
  /alerts:
    post:
      summary: Send alert via MOPH Alert (Admin)
      description: Forward JSON to MOPH Alert Free Form v3.1 endpoint.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [cid, messages]
              properties:
                cid:
                  type: array
                  items: { type: string }
                messages:
                  type: array
                  items:
                    type: object
                    properties:
                      type: { type: string, enum: [text] }
                      text: { type: string }
                message_title: { type: string }
                message_html: { type: string }
                message_text: { type: string }
                message_type: { type: string, example: HPT }
      responses:
        '200': { description: OK }
        '401': { description: Unauthorized }
        '502': { description: Upstream error }
  /notify:
    post:
      summary: Send message via MOPH Notify (Admin)
      description: Generic proxy. Body will be forwarded as-is to configured Notify endpoint.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200': { description: OK }
        '401': { description: Unauthorized }
        '502': { description: Upstream error }
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: API_KEY
      description: Use "Bearer ssjmuk_2025" for development
  schemas: {}
